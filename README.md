# Core-v4
The new SCE-CORE (fork from Project-MEANserver)
A web application based off of the MEAN stack for use with SCE

Current Version: Alpha (v4.0.1)

---

## Table of Contents
- [Setup and Dependencies](#setup-and-dependencies)
  - [Linux/Mac](#on-linuxmac)
  - [Windows](#on-windows)
- [Application Execution](#application-execution)
- [Directory Structure](#directory-structure)
- [Using the MEANserver](#using-the-meanserver)
  - [Endpoint Creation](#endpoint-creation)
  - [Adding Webpages](#adding-webpages)
- [Stable Endpoint Map](#stable-endpoint-map)
- [Release Notes](#release-notes)

---

## Setup and Dependencies
This project was built in the Ubuntu Xenial 16.04 LTS Linux environment, and was built on
- Node.js v8.9.1
- ExpressJS NPM package v4.16.2
- Body-Parser NPM package v1.18.2
- JQuery v1.12.4
- MongoDB Official Driver NPM package v2.2.33

#### On Linux/Mac
  - You can acquire **Node.js** from *nodejs.org* or through the command line using *apt-get*. Verify installation using *node -v* on command line.
  - To acquire the other packages, you will need **npm** (the Node Package Manager), which comes pre-installed with Node.js. To verify its installation, you can run *npm -v* on command line.
  - Install required Node.js Packages (all listed in package.json under 'dependencies'):
  ```
  npm install
  ```
  - Install MongoDB locally on you machine (follow the relevant installation instructions on MongoDB's website)

#### On Windows
  - You can install **Node.js** directly from their website using their installer. Afterwards, you can perform the same Linux/Mac verification and package installation steps (displayed above) by using Windows command prompt or PowerShell

---

## Application Execution
#### On Linux/Mac/Windows
  _**BEFORE**_ starting the server, be sure to perform necessary common resource setup described in the [Common Resources Readme](./util/common/README.md). Then to run the server on Linux/Mac/Windows command line, you can use *node server.js* in the project's root directory. It runs the webserver on port 8080 by default. The server also checks that your MongoDB server is online before running, else it throws an error and fails startup. Make sure you have started your MongoDB server (see MongoDB's website for installation instructions relevant to your system) _**before**_ running server.js.

  Once this is done, you may simply pop open your favorite web browser and enter "localhost:8080" (or whichever port you launched the server in), and the webpage should be properly displayed.
  
---

## Directory Structure
#### */*
  - This directory is the project root directory, and contains the following files and folders.
    1. /log/
    1. /public/
    1. /server.js
    1. /util/
    1. /test/
    1. /mdbi/
#### */log/*
  - This directory contains log files generated by the server while it is running.
#### */public/*
  - This directory contains all web pages and files to be served by server.js upon request, and contains the following:
    1. css/ - webpage css directory
    1. js/ - webpage javascript directory
    1. index.html - login/front-facing portal page
  - Any added HTML files can go directly in /public
#### */server.js*
  - This file comprises the MEAN stack webserver that will be serving all requests with the relevant endpoints.
#### */util/*
  - This directory contains various utility files for server.js, and includes
    1. settings.js - file containing core server settings
    1. logger.js - a server utility that allows server.js to log various events to logfiles in the /log/ directory
    1. route_handlers.js - a collection of endpoint handler callbacks to service the different requests coming to the server for various endpoints.
#### */test/*
  - This directory contains a MongoDB Test Interface App used for testing basic database transactions. Previously routed within route_handlers.js, the Test Interface is now housed in its own app to be used as a sub-app by server.js. The following files are contained within it:
    1. app.js - the ExpressJS sub-app that links all requests to the "/test" endpoint
    1. testRoutes/index.js - the ExpressJS router that routes all "/test" endpoint requests
#### */mdbi/*
  - This directory comprises the sub-app that handles all MongoDB database transactions. Previously housed within route_handlers.js, all database-related functions are now abstracted into here. See the internal README for more details on relevant database access endpoints. The following files are contained within it:
    1. app.js - the ExpressJS sub-app that links all requests to the "/mdbi" endpoint
    1. mdbiRoutes/index.js - the ExpressJS router that routes all "/mdbi" endpoint requests (i.e. database CRUD operations) to their relevant handlers.
    1. mongoWrapper.js - the collection of all MongoDB NodeJS Driver API wrapper functions that perform all database transactions for the main server and all other sub-apps that require database access.
    1. README - An internal readme describing the MDBI module.

---

## Using the MEANserver
#### Endpoint Creation
  - Endpoints are declared in **server.js**. To create an endpoint having a URI of "*/someEndpoint*", the express.js **app.get()** or **app.post()** methods can be used (depending on your desired request type). By using one of these methods, you can effectively associate an endpoint name (i.e. "*/someEndpoint*") with a handler function to service any requests to it. The available handler functions are imported from the **handle_map** object within **route_handlers.js**. Let's assume that you expect this endpoint to receive POST requests. Therefore, after creating a handler function "*someEndpointHandler*" in the **handle_map** to service your request, associating it is simply done in **server.js** using the line
  ```javascript
  app.post("/someEndpoint", handles.someEndpointHandler);
  ```
#### Adding Webpages
  - You can add new webpages to the server by first assigning an endpoint to serve the page (see the **Endpoint Creation** section for more details). Afterwards, you can place your webpage files in the relevant sections of the **/public** directory.

---

## Stable Endpoint Map
#### Description
  - This section lists and describes the **stable** endpoints (i.e. whose functions and endpoint names are not expected to change by much within the near future). All webpages within the server can use these endpoints to perform their designated functions.

#### Endpoints
###### "/" - Root
  - Serves requests going out to the server root (i.e. localhost:8080, if using default settings)

###### "/login" - Service Login (Coming Soon)
  - This endpoint services any login POST requests and expects the {TBD} JSON object to be passed via the request header's data section. This can be done using **utility.js**'s **post()** function (or JQuery.ajax() if you know how to use it).

###### "/test" - MongoDB Test Interface
  - This endpoint provides access to a test page that tests basic CRUD operations with the MDBI sub-app.

###### "/mdbi" - MongoDB Interface Module
  - This endpoint provides (currently unrestricted) access to the MongoDB Database used by Core-v4. See the MDBI readme for more information on the available endpoints.

---

## Release Notes
- Alpha
  - Currently modularizing the system by abstracting distinct system functions into their own sub-apps to be managed by server.js.
